<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">ØµÙØ­Ø© Ø§Ù„Ø¯ÙˆØ±Ø© - Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</title>
    
    <link rel="stylesheet" href="assets/fonts/tajawal.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary-color: #0d3b14; /* Ù„ÙˆÙ† Ø§Ù„Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø£Ø®Ø¶Ø± Ø§Ù„Ø¯Ø§ÙƒÙ† */
            --accent-color: #e6b31e;  /* Ù„ÙˆÙ† Ø°Ù‡Ø¨ÙŠ/Ø£ØµÙØ± Ù„Ù„ØªØ£ÙƒÙŠØ¯ */
            --bg-color: #f7f7f7;
            --text-color: #333;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            line-height: 1.7;
        }

        .container {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        h1, h2, h3 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
            margin-top: 30px;
        }

        .hero {
            background-color: var(--primary-color);
            color: white;
            padding: 40px 0;
            text-align: center;
            border-radius: 12px 12px 0 0;
            margin: -20px -20px 20px -20px;
        }
        
        .hero h1 {
            color: white;
            border-bottom: none;
            margin-bottom: 10px;
        }

        .list-section ul {
            list-style: none;
            padding-right: 0;
        }

        .list-section ul li {
            margin-bottom: 10px;
            border-right: 3px solid var(--accent-color);
            padding-right: 15px;
            display: flex;
            align-items: flex-start;
        }
        
        .list-section ul li i {
            color: var(--primary-color);
            margin-left: 10px;
            font-size: 1.1em;
            margin-top: 5px;
        }

        .btn-register {
            display: inline-block;
            background-color: var(--accent-color);
            color: var(--primary-color);
            padding: 12px 30px;
            text-decoration: none;
            font-size: 1.1em;
            font-weight: bold;
            border-radius: 8px;
            transition: background-color 0.3s;
            margin-top: 20px;
        }
        .btn-register:hover {
            background-color: #e6a51e;
        }
        
        #status-indicator {
            position: fixed;
            top: 10px;
            left: 10px;
            font-size: 24px;
        }
        
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .instructor-card, .testimonial-card {
            background-color: #f0f0f0;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .instructor-card img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 10px;
        }
        .faq-item {
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        .faq-question {
            background-color: var(--primary-color);
            color: white;
            padding: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
        }
        .faq-answer-content {
            padding: 15px;
            background-color: #fff;
            border-top: 1px solid #ddd;
            display: none;
        }
        .faq-question i {
            transition: transform 0.3s;
        }
        .faq-question.active i {
            transform: rotate(180deg);
        }

    </style>
</head>
<body>

<span id="status-indicator"></span>

<div class="hero">
    <h1 id="hero-title">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø©...</h1>
    <p id="hero-description"></p>
</div>

<div class="container">
    
    <div id="loading-message">
        <h3 style="text-align:center;">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±ØŒ ÙŠØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</h3>
        <p style="text-align:center; color:#999;">ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø¹Ø§Ù…Ù„ `?id=COURSE_ID` ÙÙŠ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙØ­Ø©.</p>
    </div>

    <div id="course-content" style="display:none;">

        <h2>ğŸ“– Ù†Ø¨Ø°Ø© Ø¹Ù† Ø§Ù„Ø¯ÙˆØ±Ø©</h2>
        <p id="course-about"></p>
        
        <div id="video-embed" style="margin-bottom: 30px;"></div>

        <div class="list-section">
            <h2>ğŸ¯ Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø¯ÙˆØ±Ø©</h2>
            <ul id="objectives-list"></ul>
        </div>

        <div class="list-section">
            <h2>ğŸ“Œ Ø§Ù„Ù…Ø­Ø§ÙˆØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h2>
            <ul id="axes-list"></ul>
        </div>
        
        <div>
            <h2>ğŸ“ ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ†</h2>
            <div id="instructors-container" class="card-grid"></div>
        </div>
        
        <div>
            <h2>ğŸ’¬ Ø¢Ø±Ø§Ø¡ Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ†</h2>
            <div id="testimonials-container" class="card-grid"></div>
        </div>

        <div>
            <h2>â“ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©</h2>
            <div id="faq-container"></div>
        </div>

        <div class="list-section">
             <h2>ğŸ† Ø¥Ù†Ø¬Ø§Ø²Ùƒ Ø¨Ø¹Ø¯ Ø§Ù„Ø¯ÙˆØ±Ø©</h2>
             <ul id="achievements-list"></ul>
        </div>

        <div style="text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px dashed #ddd;">
            <h2>ğŸ’¡ Ù„ØªØ¨Ø¯Ø£ Ø±Ø­Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ØŒ Ø§Ù†Ù‚Ø± Ù‡Ù†Ø§ Ù„Ù„ØªØ³Ø¬ÙŠÙ„!</h2>
            <a href="form.html" id="register-link" class="btn btn-register">
                Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ù„ØªØ³Ø¬ÙŠÙ„
            </a>
        </div>
    </div>
</div>

<footer>
    </footer>

<script>
    // ====================================================================
    //                   *** Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ***
    // ====================================================================
    
    /** Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø³ÙŠØ·Ø© Ù…Ù† Ù…ØµÙÙˆÙØ© */
    function renderList(elementId, data, iconClass) {
        const listElement = document.getElementById(elementId);
        const parentSection = listElement.closest('.list-section, div:has(h2)');

        if (!data || !Array.isArray(data) || data.length === 0) {
            if (parentSection) parentSection.style.display = 'none';
            return;
        }
        
        listElement.innerHTML = '';
        data.forEach(text => {
            const li = document.createElement('li');
            li.innerHTML = `<i class="${iconClass}"></i> ${text.trim()}`;
            listElement.appendChild(li);
        });
        if (parentSection) parentSection.style.display = 'block';
    }

    /** Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ† */
    function renderInstructors(data) {
        const container = document.getElementById('instructors-container');
        const parentSection = container.parentElement;
        
        if (!data || !Array.isArray(data) || data.length === 0) {
            parentSection.style.display = 'none';
            return;
        }
        
        container.innerHTML = data.map(inst => `
            <div class="instructor-card">
                <img src="${inst.img || 'https://via.placeholder.com/150'}" alt="${inst.name}" onerror="this.onerror=null;this.src='https://via.placeholder.com/150/0d3b14/ffffff?text=Ù„Ø§+ÙŠÙˆØ¬Ø¯+ØµÙˆØ±Ø©';">
                <h4>${inst.name}</h4>
                <p>${inst.title || inst.role || ''}</p>
            </div>
        `).join('');
        parentSection.style.display = 'block';
    }
    
    /** Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø§Øª Ø¢Ø±Ø§Ø¡ Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ† */
    function renderTestimonials(data) {
        const container = document.getElementById('testimonials-container');
        const parentSection = container.parentElement;
        
        if (!data || !Array.isArray(data) || data.length === 0) {
            parentSection.style.display = 'none';
            return;
        }

        container.innerHTML = data.map(t => `
            <div class="testimonial-card">
                <p class="testimonial-text">"${t.text}"</p>
                <p><strong>${t.name}</strong></p>
            </div>
        `).join('');
        parentSection.style.display = 'block';
    }
    
    /** Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø³Ù… Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© */
    function setupFaq(faqsData) {
        const faqContainer = document.getElementById('faq-container');
        const parentSection = faqContainer.parentElement;

        if (!faqsData || !Array.isArray(faqsData) || faqsData.length === 0) {
            parentSection.style.display = 'none';
            return;
        }
        
        faqContainer.innerHTML = faqsData.map(f => `
            <div class="faq-item">
                <div class="faq-question"><span>${f.question}</span><i class="fa fa-chevron-down"></i></div>
                <div class="faq-answer-content">${f.answer}</div>
            </div>
        `).join('');
        
        document.querySelectorAll('.faq-question').forEach(q => {
            q.addEventListener('click', () => {
                const ans = q.nextElementSibling;
                const icon = q.querySelector('i');
                
                // Toggle active state and display
                q.classList.toggle('active');
                if (q.classList.contains('active')) {
                    ans.style.display = 'block';
                    icon.style.transform = 'rotate(180deg)';
                } else {
                    ans.style.display = 'none';
                    icon.style.transform = 'rotate(0deg)';
                }
            });
        });
        parentSection.style.display = 'block';
    }
    
    // ====================================================================
    //                   *** Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ***
    // ====================================================================

    async function loadCourseData() {
        const statusIndicator = document.getElementById('status-indicator');
        const urlParams = new URLSearchParams(window.location.search);
        const courseId = urlParams.get('id'); 
        const loadingMessage = document.getElementById('loading-message');
        const courseContent = document.getElementById('course-content');

        statusIndicator.innerHTML = 'ğŸŸ¡';
        loadingMessage.style.display = 'block';

        if (!courseId) {
            statusIndicator.innerHTML = 'ğŸ”´';
            document.getElementById('hero-title').innerText = "âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¯ÙˆØ±Ø©";
            document.getElementById('hero-description').innerText = "ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø¨Ø¯ÙˆÙ† Ù…Ø¹Ø±Ù Ø§Ù„Ø¯ÙˆØ±Ø©.";
            loadingMessage.style.display = 'none';
            return;
        }

        try {
            // âœ… ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ù‡Ùˆ Ø§Ù„ØµØ­ÙŠØ­ ØªÙ…Ø§Ù…Ø§Ù‹ Ù„Ù€ Google Apps Script
            const API_BASE_URL = 'https://script.google.com/macros/s/AKfycbz8a_AvFDj2M6JgcmqmpU2ZKY4-J-E4kCDm9qSwo5HsG9D9EcxMh-fGQkKtfuRKnNRI/exec';
            
            // 1. Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const apiUrl = `${API_BASE_URL}?action=courses`; 
            const response = await fetch(apiUrl);
            const allCourses = await response.json();
            
            // 2. Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¯ÙˆØ±Ø©
            const course = allCourses.find(c => c.id == courseId); 
            
            if (!course || !course.title) {
                statusIndicator.innerHTML = 'ğŸ”´';
                document.getElementById('hero-title').innerText = "âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©";
                document.getElementById('hero-description').innerText = "ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø¹Ø±Ù Ø§Ù„Ø¯ÙˆØ±Ø© ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·.";
                loadingMessage.style.display = 'none';
                return;
            }

            // 3. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
            document.getElementById('page-title').innerText = course.title;
            document.getElementById('hero-title').innerText = course.title || "Ø¯ÙˆØ±Ø© ØªØ¯Ø±ÙŠØ¨ÙŠØ© Ù…ØªØ®ØµØµØ©";
            document.getElementById('hero-description').innerText = course.heroDescription || "";
            document.getElementById('course-about').innerText = course.courseAbout || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø¨Ø°Ø© Ù…ØªÙˆÙØ±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.";

            // 4. ØªØ­Ø¯ÙŠØ« Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
            const videoEmbed = document.getElementById('video-embed');
            if (course.videoUrl && course.videoUrl.includes('youtube.com')) {
                const embedUrl = course.videoUrl.replace('watch?v=', 'embed/').split('&')[0];
                videoEmbed.innerHTML = `
                    <iframe width="100%" height="400" src="${embedUrl}" 
                            frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen style="border-radius:8px;">
                    </iframe>`;
            } else {
                 videoEmbed.style.display = 'none';
            }

            // 5. Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø³ÙŠØ·Ø©
            try {
                // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†ØµÙŠØ© Ø¥Ù„Ù‰ Ù…ØµÙÙˆÙØ§Øª Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
                const parseData = (data) => typeof data === 'string' ? JSON.parse(data) : data;

                renderList('objectives-list', parseData(course.objectives), 'fa fa-check-circle');
                renderList('axes-list', parseData(course.axes), 'fa fa-arrow-alt-circle-left');
                renderList('achievements-list', parseData(course.achievementsText), 'fa fa-star');
                
                renderInstructors(parseData(course.instructors));
                renderTestimonials(parseData(course.testimonials));
                setupFaq(parseData(course.faqs));

                // ØªØ­Ø¯ÙŠØ« Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                document.getElementById('register-link').href = `form.html?course=${encodeURIComponent(course.title)}`;
                
                statusIndicator.innerHTML = 'ğŸŸ¢';
                
            } catch (renderingError) {
                 console.error('Internal content rendering error:', renderingError);
                 statusIndicator.innerHTML = 'âš ï¸';
            }

            // Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰
            loadingMessage.style.display = 'none';
            courseContent.style.display = 'block';

        } catch (err) {
            // ÙŠØªÙ… ØªÙ†ÙÙŠØ° Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„Ø¬Ù„Ø¨ (fetch) Ù†ÙØ³Ù‡
            console.error('Fatal fetch error:', err);
            statusIndicator.innerHTML = 'ğŸ”´';
            document.getElementById('hero-title').innerText = "âš ï¸ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø§Ø¯Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
            document.getElementById('hero-description').innerHTML = "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø±Ø§Ø¨Ø· Ø§Ù„Ù€ API ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ø£Ùˆ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©.";
            loadingMessage.style.display = 'none';
        }
    }

    // Ø§Ø¨Ø¯Ø£ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    document.addEventListener('DOMContentLoaded', loadCourseData);
</script>

</body>
</html>
