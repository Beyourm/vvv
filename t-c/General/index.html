<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„</title>
  
      <meta property="og:title" content="Ù…Ø¤Ø³Ø³Ø© ÙƒÙ† Ø£Ù†Øª Ù„Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªØ£Ù‡ÙŠÙ„" />
    <meta property="og:description" content="Ù†ØµÙ†Ø¹ Ù‚Ø§Ø¯Ø© Ø§Ù„ØºØ¯ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù…Ø¹Ø±ÙØ©. Ø§Ø³ØªØ«Ù…Ø± ÙÙŠ Ù†ÙØ³ÙƒØŒ ÙˆØ§Ø³ØªØ«Ù…Ø± ÙÙŠ Ù…Ø³ØªÙ‚Ø¨Ù„Ùƒ." />
    <meta property="og:image" content="https://skillia.netlify.app/images/photo.jpg" />
    <meta property="og:url" content="https://sklilia.netlify.app/Trainees_Records" />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="ar_AR" />
    
    
  <meta name="description" content="Ù…Ø¤Ø³Ø³Ø© ÙƒÙ† Ø£Ù†Øª Ù„Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªØ£Ù‡ÙŠÙ„. Ù†Ù‚Ø¯Ù… Ø¯ÙˆØ±Ø§Øª Ù…ØªØ®ØµØµØ© ÙÙŠ ØªØ·ÙˆÙŠØ± Ø§Ù„Ø°Ø§ØªØŒ Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠØŒ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ØŒ ÙˆØ§Ù„Ù…Ø²ÙŠØ¯.">
  <meta name="keywords" content="Ø¯ÙˆØ±Ø§Øª ØªØ¯Ø±ÙŠØ¨ÙŠØ©ØŒ Ù…Ø¤Ø³Ø³Ø© ÙƒÙ† Ø£Ù†ØªØŒ ØªØ·ÙˆÙŠØ± Ø§Ù„Ø°Ø§ØªØŒ Ø§Ù„ÙŠÙ…Ù†ØŒ ØµÙ†Ø¹Ø§Ø¡ØŒ Ø¯ÙˆØ±Ø§Øª Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†ØŒ Ø­ÙØ¸ Ø§Ù„Ù‚Ø±Ø¢Ù†">
  
<link rel="preload" href="../assets/fonts/tajawal.css" as="style" onload="this.rel='stylesheet'">
 <link rel="stylesheet" href="../../assets/fonts/tajawal.css">
<link rel="stylesheet" href="style.css">




</head>
<body>

<div id="loader">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>

<div class="header">
  <div class="search-container">
    <input type="text" id="searchInput" oninput="filterCards()" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„ÙƒÙˆØ±Ø³ØŒ Ø£Ùˆ Ø§Ù„ÙƒÙˆØ¯...">
  </div>
</div>

<div class="filter-row">
    <div class="header-filter-container">
        <label for="marketerSelect" style="display: block; margin-bottom: 8px; font-weight: bold; color: var(--primary-darker);">
            ğŸ‘¤ ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ÙˆÙ‘Ù‚:
        </label>
        <select id="marketerSelect" onchange="handleMarketerFilterChange(this.value)">
            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ÙˆÙ‘Ù‚ÙŠÙ†</option>
            </select>
    </div>
</div>

<div class="content">
  <div class="tab-content active" id="tab1">
    <h2>ğŸ“š Ù‚Ø§Ø¦Ù…Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
    <div id="students-container" class="students-container">
      <div class="loader-placeholder">
        <div class="loader">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨...</div>
      </div>
    </div>
  </div>

  <div class="tab-content" id="tab2">
    <h2>ğŸ’° Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø§ÙØ¹ÙŠÙ† ÙˆØ§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</h2>
    <div id="payers-container" class="students-container">
        <div class="loader-placeholder">
            <div class="loader">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø§ÙØ¹ÙŠÙ†...</div>
        </div>
    </div>
  </div>

  <div class="tab-content" id="tab3">
    <h2>ğŸ‘¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ÙˆÙ‘Ù‚ÙŠÙ† Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</h2>
    <div id="marketers-container" class="students-container">
        <div class="loader-placeholder">
            <div class="loader">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ÙˆÙ‘Ù‚ÙŠÙ†...</div>
        </div>
    </div>
  </div>

  <div class="tab-content" id="tab4">
    <h2>ğŸ’² Ù…Ù„Ø®Øµ Ø¹Ù…ÙˆÙ„Ø§Øª Ø§Ù„Ù…Ø³ÙˆÙ‘Ù‚ÙŠÙ†</h2>
    <div id="commissions-container" class="students-container">
        <div class="loader-placeholder">
            <div class="loader">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª...</div>
        </div>
    </div>
  </div>
</div>

<div class="tabs">
  <div class="tab active" onclick="showTab(1)">Ø¬ Ø§Ù„Ø·Ù„Ø§Ø¨</div>
  <div class="tab" onclick="showTab(2)">Ø¬ Ø§Ù„Ø¯Ø§ÙØ¹ÙŠÙ†</div>
  <div class="tab" onclick="showTab(3)">Ø¬ Ø§Ù„Ù…Ø³ÙˆÙ‚ÙŠÙ†</div>
  <div class="tab" onclick="showTab(4)">Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª</div>
</div>

<script>
// ==============================================
//        Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙˆØ§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
// ==============================================
const STUDENTS_DATA_URL = 'https://script.google.com/macros/s/AKfycbxTAdC8g-J42sbnCfIxe2_Z286N5v7vKVhrL9iyJ_b3JzRMIpsClyPWqYV7usFjiIKmVQ/exec';
const PAYERS_DATA_URL = 'https://script.google.com/macros/s/AKfycbyT7IZOVPIqwg4mM8crdSsvOzXFiYKzyZfdBk2N1sTk2HFFcBbkPWcbszU92hKT96docw/exec';
const MARKETERS_DATA_URL = 'https://script.google.com/macros/s/AKfycbz-oJ9hpI6R-y-aRh4k10sbsyvcSam_BOB0BwYN77eE5OFazSLjF87kPTzF5zbgzRVh/exec';
const COMMISSIONS_DATA_URL = 'https://script.google.com/macros/s/AKfycbyDhar1MzMQYqP-6zpeHHEhBvWYkFif8rJJWSy79MN32g16nUNIxmcZst46Wq3BczSRbw/exec';

let allStudentsData = []; 
let allPayersData = []; 
let allMarketersData = []; 
let allCommissionsData = []; 
let currentActiveTabId = 'tab1';

// Ù…ØªØºÙŠØ±Ø§ Ø§Ù„ÙÙ„ØªØ±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©
let currentMarketerFilter = ''; 
let currentSearchTerm = '';
const SELECT_ELEMENT_ID = 'marketerSelect'; // ID Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ø®ØªØ§Ø±


// ==============================================
//        ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙˆØ§Ù„ØªÙ†Ø³ÙŠÙ‚
// ==============================================

function escapeHTML(str) {
  if (str === null || str === undefined || str === '') return '-';
  if (str === 0) return '0';
  if (typeof str === 'string' && str.startsWith('https://script.google.com/macros/')) {
    return 'Ø±Ø§Ø¨Ø· API';
  }
  return str.toString().replace(/[&<>"']/g, match => ({
    '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
  }[match]));
}

function formatFlexibleDate(dateString) {
    if (!dateString) return 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
    try {
        const dateObj = new Date(dateString);
        if (!isNaN(dateObj) && dateObj.getFullYear() > 2000) { 
            return dateObj.toLocaleDateString('ar-EG', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric'
            });
        }
    } catch (e) {
        return escapeHTML(dateString);
    }
    return escapeHTML(dateString);
}

function formatISODate(isoString) {
    if (!isoString) return 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
    try {
        const dateObj = new Date(isoString);
        if (isNaN(dateObj)) {
            return escapeHTML(isoString);
        }
        return dateObj.toLocaleDateString('ar-EG', { 
            year: 'numeric', 
            month: 'short', 
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
    } catch (e) {
        return escapeHTML(isoString);
    }
}

function formatCurrency(number) {
    if (typeof number !== 'number') {
        number = parseFloat(number);
    }
    if (isNaN(number)) {
        return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
    }
    return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
        minimumFractionDigits: 0, 
        maximumFractionDigits: 0
    }).format(number);
}


function formatReceipt(link) {
    if (!link || typeof link !== 'string' || !link.includes('drive.google.com')) {
        return `<span style="color: var(--error-color, #E74C3C);">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥ÙŠØµØ§Ù„/Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ§Ù„Ø­.</span>`;
    }

    const match = link.match(/\/d\/([a-zA-Z0-9_-]+)/);
    const fileId = match ? match[1] : null;
    const linkText = 'Ø¹Ø±Ø¶ Ø§Ù„Ø¥ÙŠØµØ§Ù„ (Ø±Ø§Ø¨Ø· Ø£ØµÙ„ÙŠ)';

    if (fileId) {
        const directLink = `https://drive.google.com/thumbnail?id=${fileId}&sz=w250`; 

        return `
            <span class="label" style="display: block; margin-top: 10px;">ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„:</span>
            <a href="${link}" target="_blank" class="receipt-img-container" style="display: block;">
                <img src="${directLink}" alt="ØµÙˆØ±Ø© Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¯ÙØ¹" 
                     onerror="this.onerror=null; this.src='https://via.placeholder.com/150?text=ØªØ¹Ø°Ø±+Ø¹Ø±Ø¶+Ø§Ù„ØµÙˆØ±Ø©';"
                     style="max-width: 100%; height: auto; border-radius: 5px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            </a>
            <a href="${link}" target="_blank" style="font-size: 0.8rem; color: var(--primary-darker); display: block; margin-top: 5px;">${linkText}</a>
        `;
    } else {
        return `<span class="label">Ø§Ù„Ø¥ÙŠØµØ§Ù„ (Ø±Ø§Ø¨Ø·):</span> <a href="${link}" target="_blank" style="color: var(--primary-color);">${linkText}</a>`;
    }
}


// ==============================================
//        ÙˆØ¸Ø§Ø¦Ù Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø¹Ø±Ø¶ (Tab 1: Students)
// ==============================================
async function loadStudentsData() {
  const container = document.getElementById('students-container');
  if (!container) return;
  
  if (allStudentsData.length === 0) {
      container.innerHTML = `<div class="loader-placeholder"><div class="loader">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨...</div></div>`;
  }

  try {
    if (allStudentsData.length === 0) {
        const response = await fetch(STUDENTS_DATA_URL);
        if (!response.ok) {
            throw new Error(`ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. Ø§Ù„Ø­Ø§Ù„Ø©: ${response.status}`);
        }
        allStudentsData = await response.json();
    }

    renderStudentsCards(allStudentsData);
    
  } catch (err) {
    console.error('Error fetching students data:', err);
    container.style.display = 'block';
    container.innerHTML = `<p style="text-align:center; color: var(--error-color); padding: 10px; border-radius: 8px;">
        Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨: ${err.message}.
    </p>`;
  }
}

function renderStudentsCards(students) {
    const container = document.getElementById('students-container');
    if (!container) return;

    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±Ø©
    let filteredStudents = students.filter(s => {
        const textContent = 
            (s['Ø§Ù„Ø§Ø³Ù…'] || '') + (s['Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©'] || '') + (s['Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨'] || '') + (s['Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø³ÙˆÙ‘Ù‚'] || '');
        const searchMatch = textContent.toLowerCase().includes(currentSearchTerm.toLowerCase());
        
        const marketerId = (s['Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø³ÙˆÙ‘Ù‚'] || '').toLowerCase();
        const marketerMatch = currentMarketerFilter === "" || marketerId === currentMarketerFilter.toLowerCase();
        
        return searchMatch && marketerMatch;
    });

    if (!Array.isArray(filteredStudents) || filteredStudents.length === 0) {
        container.style.display = 'block';
        const message = currentSearchTerm || currentMarketerFilter ? 
            `Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø« Ø£Ùˆ Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ù…Ø®ØªØ§Ø±.` : 
            'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø·Ù„Ø§Ø¨ Ù„Ø¹Ø±Ø¶Ù‡Ø§ Ø­Ø§Ù„ÙŠØ§Ù‹.';
        container.innerHTML = `<p style="text-align:center; color: var(--text-color-dark);">${message}</p>`;
        return;
    }

    const cardsHtml = filteredStudents.map(s => {
      const name = escapeHTML(s['Ø§Ù„Ø§Ø³Ù…']); 
      const course = `Ø¯ÙˆØ±Ø© : ${escapeHTML(s['Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©'])}`; 
      const phoneRaw = s['Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨']; 
      const phone = phoneRaw ? `<a href="tel:${phoneRaw}" target="_blank" style="color: var(--primary-color); text-decoration: none;">${escapeHTML(phoneRaw)}</a>` : 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
      const registrationDate = formatFlexibleDate(s['ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„']); 
      const marketerId = escapeHTML(s['Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø³ÙˆÙ‘Ù‚']); 
      const country = escapeHTML(s['Ø§Ù„Ø¨Ù„Ø¯']); 
      const gender = escapeHTML(s['Ø§Ù„Ø¬Ù†Ø³']);
      const age = escapeHTML(s['Ø§Ù„Ø¹Ù…Ø±']);
      const email = escapeHTML(s['Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ']);
      const telegram = escapeHTML(s['ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…']);
      const statusRaw = s['Ø§Ù„Ø­Ø§Ù„Ø©'];
      const status = statusRaw && (statusRaw.toUpperCase() === 'Y' || statusRaw.includes('Ù…Ø¯ÙÙˆØ¹'));
      const statusText = status ? 'ØªÙ… Ø§Ù„Ø¯ÙØ¹' : 'Ù„Ù… ÙŠØ¯ÙØ¹';
      const statusColor = status ? 'var(--success-color)' : 'var(--warning-color)';
      
      return `
        <div class="student-card" data-marketer-id="${marketerId}" style="border-right: 5px solid ${statusColor};">
          <div class="course">${course}</div>
          <h3>${name} <span class="status ${status ? 'paid' : 'unpaid'}" style="float: left;">${statusText}</span></h3>
          
          <div class="info">
            <div><span class="label">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„:</span> ${registrationDate}</div>
            <div><span class="label">Ø§Ù„Ø¨Ù„Ø¯:</span> ${country}</div>
            <div><span class="label">Ø§Ù„Ø¬Ù†Ø³ / Ø§Ù„Ø¹Ù…Ø±:</span> ${gender} / ${age}</div>
            <div><span class="label">Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø³ÙˆÙ‘Ù‚:</span> ${marketerId}</div>
            
            <hr style="border-top: 1px dashed var(--border-color); margin: 10px 0;">
            
            <div><span class="label">Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨:</span> ${phone}</div>
            <div><span class="label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</span> ${email}</div>
            <div><span class="label">ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…:</span> ${telegram}</div>
          </div>
        </div>
      `;
    }).join('');
    
    container.style.display = 'grid'; 
    container.innerHTML = cardsHtml;
}

// ==============================================
//        ÙˆØ¸Ø§Ø¦Ù Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø¹Ø±Ø¶ (Tab 2: Payers)
// ==============================================
async function loadPayersData() {
  const container = document.getElementById('payers-container');
  if (!container) return;
  
  if (allPayersData.length === 0) {
      container.innerHTML = `<div class="loader-placeholder"><div class="loader">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø§ÙØ¹ÙŠÙ†...</div></div>`;
  }

  try {
    if (allPayersData.length === 0) {
        const response = await fetch(PAYERS_DATA_URL);
        if (!response.ok) {
            throw new Error(`ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. Ø§Ù„Ø­Ø§Ù„Ø©: ${response.status}`);
        }
        allPayersData = await response.json();
    }
    
    renderPayersCards(allPayersData);
    
  } catch (err) {
    console.error('Error fetching payers data:', err);
    container.style.display = 'block';
    container.innerHTML = `<p style="text-align:center; color: var(--error-color); padding: 10px; border-radius: 8px;">
        Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø§ÙØ¹ÙŠÙ†: ${err.message}.
    </p>`;
  }
}

function renderPayersCards(payers) {
    const container = document.getElementById('payers-container');
    if (!container) return;
    
    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±Ø©
    let filteredPayers = payers.filter(p => {
        const textContent = 
            (p['Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„'] || '') + (p['Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨'] || '') + (p['Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ'] || '') + (p['marketer_id'] || '');
        const searchMatch = textContent.toLowerCase().includes(currentSearchTerm.toLowerCase());

        const marketerId = (p['marketer_id'] || '').toLowerCase();
        const marketerMatch = currentMarketerFilter === "" || marketerId === currentMarketerFilter.toLowerCase();

        return searchMatch && marketerMatch;
    });

    if (!Array.isArray(filteredPayers) || filteredPayers.length === 0) {
        container.style.display = 'block';
        const message = currentSearchTerm || currentMarketerFilter ? 
            `Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø¯Ø§ÙØ¹ÙŠÙ† Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø« Ø£Ùˆ Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ù…Ø®ØªØ§Ø±.` : 
            'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø§ÙØ¹ÙŠÙ† Ù„Ø¹Ø±Ø¶Ù‡Ø§ Ø­Ø§Ù„ÙŠØ§Ù‹.';
        container.innerHTML = `<p style="text-align:center; color: var(--text-color-dark);">${message}</p>`;
        return;
    }

    const cardsHtml = filteredPayers.map(p => {
      const name = escapeHTML(p['Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„']);
      const course = `Ø¯ÙˆØ±Ø© : ${escapeHTML(p['Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨'])}`;
      const phoneRaw = p['Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ'];
      const phone = phoneRaw ? `<a href="tel:${phoneRaw}" target="_blank" style="color: var(--primary-color); text-decoration: none;">${escapeHTML(phoneRaw)}</a>` : 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
      const email = escapeHTML(p['Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ']);
      const marketerId = escapeHTML(p['marketer_id']); 
      const receiptLinkField = p['Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥ÙŠØµØ§Ù„']; 
      const paidAmount = p['Ø§Ù„Ø±Ø³ÙˆÙ…'] ? `${escapeHTML(p['Ø§Ù„Ø±Ø³ÙˆÙ…'])} $` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
      const paymentMethod = escapeHTML(p['Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©']);
      const receiptHTML = formatReceipt(receiptLinkField);
      
      return `
        <div class="student-card" data-marketer-id="${marketerId}" style="border-right: 5px solid var(--success-color);">
          <div class="course">${course}</div>
          <h3>${name} <span class="status paid" style="float: left;">ØªÙ… Ø§Ù„Ø¯ÙØ¹</span></h3>
          
          <div class="info">
            <div><span class="label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</span> ${name}</div>
            <div><span class="label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</span> ${email}</div>
            <div><span class="label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</span> ${phone}</div>
            
            <hr style="border-top: 1px dashed var(--border-color); margin: 10px 0;">
            
            <div><span class="label">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹:</span> <strong style="color: var(--success-color);">${paidAmount}</strong></div>
            <div><span class="label">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</span> ${paymentMethod}</div>
            
            <div style="margin-top: 10px;">${receiptHTML}</div>
            
            <hr style="border-top: 1px solid var(--primary-color); margin: 10px 0;">
            
            <div><span class="label">Ø³Ø¬Ù„ Ø¹Ø¨Ø±:</span> ${marketerId}</div>
            
          </div>
        </div>
      `;
    }).join('');

    container.style.display = 'grid'; 
    container.innerHTML = cardsHtml;
}

// ==============================================
//        ÙˆØ¸Ø§Ø¦Ù Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø¹Ø±Ø¶ (Tab 3: Marketers)
// ==============================================
async function loadMarketersData() {
  const container = document.getElementById('marketers-container');
  if (!container) return;
  
  if (allMarketersData.length === 0) {
      container.innerHTML = `<div class="loader-placeholder"><div class="loader">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ÙˆÙ‘Ù‚ÙŠÙ†...</div></div>`;
  }

  try {
    if (allMarketersData.length === 0) {
        const response = await fetch(MARKETERS_DATA_URL);
        if (!response.ok) {
            throw new Error(`ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. Ø§Ù„Ø­Ø§Ù„Ø©: ${response.status}`);
        }
        allMarketersData = await response.json();
    }
    
    renderMarketersCards(allMarketersData);
    
  } catch (err) {
    console.error('Error fetching marketers data:', err);
    container.style.display = 'block';
    container.innerHTML = `<p style="text-align:center; color: var(--error-color); padding: 10px; border-radius: 8px;">
        Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ÙˆÙ‘Ù‚ÙŠÙ†: ${err.message}.
    </p>`;
  }
}

function renderMarketersCards(marketers) {
    const container = document.getElementById('marketers-container');
    if (!container) return;
    
    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±Ø© (ÙÙ‚Ø· Ø­Ø³Ø¨ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø«)
    const normalizedSearchTerm = currentSearchTerm.toLowerCase();
    let filteredMarketers = marketers.filter(m => {
        const name = (m['fullname'] || '').toLowerCase();
        const phone = (m['phone'] || '').toString();
        const marketerId = (m['marketer_id'] || '').toLowerCase();
        
        // Ù‡Ù†Ø§ Ù„Ø§ Ù†Ø³ØªØ®Ø¯Ù… currentMarketerFilter Ù„Ù‡Ø°Ø§ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ØŒ Ø¨Ù„ ÙÙ‚Ø· Ø§Ù„Ø¨Ø­Ø«.
        return name.includes(normalizedSearchTerm) || 
               phone.includes(normalizedSearchTerm) || 
               marketerId.includes(normalizedSearchTerm);
    });
    
    if (!Array.isArray(filteredMarketers) || filteredMarketers.length === 0) {
        container.style.display = 'block';
        const message = normalizedSearchTerm ? 
            `Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ù…Ø³ÙˆÙ‘Ù‚ÙŠÙ† Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù€: "${escapeHTML(currentSearchTerm)}".` : 
            'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³ÙˆÙ‘Ù‚ÙŠÙ† Ù„Ø¹Ø±Ø¶Ù‡Ø§ Ø­Ø§Ù„ÙŠØ§Ù‹.';
        container.innerHTML = `<p style="text-align:center; color: var(--text-color-dark);">${message}</p>`;
        return;
    }

    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
    const cardsHtml = filteredMarketers.map(m => {
      const name = escapeHTML(m['fullname']);
      const marketerId = escapeHTML(m['marketer_id']);
      const registrationDate = formatISODate(m['ØªØ§Ø±ÙŠØ®_Ø§Ù„ØªØ³Ø¬ÙŠÙ„']);
      const country = escapeHTML(m['country']);
      const gender = escapeHTML(m['gender']);
      const phoneRaw = m['phone'];
      const phone = phoneRaw ? `<a href="tel:${phoneRaw}" target="_blank" style="color: var(--primary-color); text-decoration: none;">${escapeHTML(phoneRaw)}</a>` : 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
      const emailRaw = m['email'];
      const email = emailRaw ? `<a href="mailto:${emailRaw}" target="_blank" style="color: var(--primary-color); text-decoration: none;">${escapeHTML(emailRaw)}</a>` : 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
      const status = m['Ø§Ù„Ø­Ø§Ù„Ø©'] === 'Y';
      const statusText = status ? 'Ù…ÙÙØ¹Ù‘ÙÙ„' : 'ØºÙŠØ± Ù…ÙÙØ¹Ù‘ÙÙ„';
      const statusColor = status ? 'var(--success-color)' : 'var(--error-color)';
      
      return `
        <div class="student-card" data-marketer-id="${marketerId}" style="border-right: 5px solid ${statusColor};">
          <div class="course" style="color: ${statusColor};">Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ${statusText}</div>
          <h3>${name}</h3>
          
          <div class="info">
            <div><span class="label">Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø³ÙˆÙ‘Ù‚:</span> <strong>${marketerId}</strong></div>
            <div><span class="label">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„:</span> ${registrationDate}</div>
            
            <hr style="border-top: 1px dashed var(--border-color); margin: 10px 0;">
            
            <div><span class="label">Ø§Ù„Ø¯ÙˆÙ„Ø©:</span> ${country}</div>
            <div><span class="label">Ø§Ù„Ø¬Ù†Ø³:</span> ${gender}</div>

            <hr style="border-top: 1px dashed var(--border-color); margin: 10px 0;">
            
            <div><span class="label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</span> ${phone}</div>
            <div><span class="label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</span> ${email}</div>
          </div>
        </div>
      `;
    }).join('');

    container.style.display = 'grid'; 
    container.innerHTML = cardsHtml;
}

// ==============================================
//        ÙˆØ¸Ø§Ø¦Ù Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø¹Ø±Ø¶ (Tab 4: Commissions)
// ==============================================
async function loadCommissionsData() {
  const container = document.getElementById('commissions-container');
  if (!container) return;
  
  if (allCommissionsData.length === 0) {
      container.innerHTML = `<div class="loader-placeholder"><div class="loader">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª...</div></div>`;
  }

  try {
    if (allCommissionsData.length === 0) {
        const response = await fetch(COMMISSIONS_DATA_URL);
        if (!response.ok) {
            throw new Error(`ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. Ø§Ù„Ø­Ø§Ù„Ø©: ${response.status}`);
        }
        allCommissionsData = await response.json();
    }
    
    renderCommissionsCards(allCommissionsData);
    
  } catch (err) {
    console.error('Error fetching commissions data:', err);
    container.style.display = 'block';
    container.innerHTML = `<p style="text-align:center; color: var(--error-color); padding: 10px; border-radius: 8px;">
        Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª: ${err.message}.
    </p>`;
  }
}

function renderCommissionsCards(commissions) {
    const container = document.getElementById('commissions-container');
    if (!container) return;
    
    // 1. ØªØµÙÙŠØ© Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø£Ø®ÙŠØ± Ø§Ù„ÙØ§Ø±Øº
    let filteredCommissions = commissions.filter(c => c['Ø§Ø³Ù… Ø§Ù„Ù…Ø³ÙˆÙ‘Ù‚'] && c['Ø§Ø³Ù… Ø§Ù„Ù…Ø³ÙˆÙ‘Ù‚'].trim() !== '');
    
    // 2. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±Ø© (Ø­Ø³Ø¨ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« ÙˆÙÙ„ØªØ± Ø§Ù„Ù…Ø³ÙˆÙ‚)
    const normalizedSearchTerm = currentSearchTerm.toLowerCase();
    
    filteredCommissions = filteredCommissions.filter(c => {
        const name = (c['Ø§Ø³Ù… Ø§Ù„Ù…Ø³ÙˆÙ‘Ù‚'] || '').toLowerCase();
        const marketerId = (c['Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ÙˆÙ‘Ù‚'] || '').toLowerCase();
        
        const searchMatch = name.includes(normalizedSearchTerm) || marketerId.includes(normalizedSearchTerm);
        const marketerMatch = currentMarketerFilter === "" || marketerId === currentMarketerFilter.toLowerCase(); // Ø§Ù„ÙÙ„ØªØ± Ø­Ø³Ø¨ Ø§Ù„Ù€ ID
        
        return searchMatch && marketerMatch;
    });

    if (!Array.isArray(filteredCommissions) || filteredCommissions.length === 0) {
      container.style.display = 'block';
      const message = currentSearchTerm || currentMarketerFilter ? 
            `Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù…ÙˆÙ„Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø« Ø£Ùˆ Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ù…Ø®ØªØ§Ø±.` : 
            'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù…ÙˆÙ„Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§ Ø­Ø§Ù„ÙŠØ§Ù‹.';
      container.innerHTML = `<p style="text-align:center; color: var(--text-color-dark);">${message}</p>`;
      return;
    }

    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
    const cardsHtml = filteredCommissions.map(c => {
      const name = escapeHTML(c['Ø§Ø³Ù… Ø§Ù„Ù…Ø³ÙˆÙ‘Ù‚']);
      const marketerId = escapeHTML(c['Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ÙˆÙ‘Ù‚']);
      const phoneRaw = c['Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ'];
      const phone = phoneRaw ? `<a href="tel:${phoneRaw}" target="_blank" style="color: var(--primary-color); text-decoration: none;">${escapeHTML(phoneRaw)}</a>` : 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
      const referralsCount = escapeHTML(c['Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª']);
      const paidToInstitution = formatCurrency(c['Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ù„Ù„Ù…Ø¤Ø³Ø³Ø©']);
      const commissionDue = formatCurrency(c['Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©']);
      const bonus = formatCurrency(c['Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª']);
      const commissionPercentage = escapeHTML(c['Ù†Ø³Ø¨Ø© Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©']) + '%';
      
      const dueValue = parseFloat(c['Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©']) || 0;
      const cardBorderColor = dueValue > 0 ? 'var(--warning-color)' : 'var(--success-color)';
      const dueTextColor = dueValue > 0 ? 'var(--error-color)' : 'var(--success-color)'; 
      const dueText = dueValue > 0 ? 'Ù…ØªØ¨Ù‚ÙŠØ© Ù„Ù„Ø¯ÙØ¹' : 'ØªÙ… ØªØµÙÙŠØ±Ù‡Ø§';
      
      return `
        <div class="student-card" data-marketer-id="${marketerId}" style="border-right: 5px solid ${cardBorderColor};">
          <div class="course" style="color: var(--primary-darker);">Ù…Ø¹Ø±Ù: ${marketerId}</div>
          <h3>${name} <span class="status" style="background-color: ${dueTextColor}; float: left; font-size: 0.9rem;">${dueText}</span></h3>
          
          <div class="info">
            <div><span class="label">Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª:</span> <strong style="color: var(--primary-color);">${referralsCount}</strong></div>
            <div><span class="label">Ø§Ù„Ù‡Ø§ØªÙ:</span> ${phone}</div>
            
            <hr style="border-top: 1px dashed var(--border-color); margin: 10px 0;">
            
            <div><span class="label">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ (Ù„Ù„Ù…Ø¤Ø³Ø³Ø©):</span> ${paidToInstitution}</div>
            <div><span class="label">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©:</span> ${commissionPercentage}</div>
            
            <hr style="border-top: 2px solid var(--border-color); margin: 10px 0;">
            
            <div><span class="label">Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©:</span> <strong style="color: ${dueTextColor}; font-size: 1.1em;">${commissionDue}</strong></div>
            <div><span class="label">Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª:</span> ${bonus}</div>
          </div>
        </div>
      `;
    }).join('');

    container.style.display = 'grid'; 
    container.innerHTML = cardsHtml;
}


// ==============================================
//        ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙÙ„ØªØ±Ø© ÙˆØ§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
// ==============================================

/**
 * ÙˆØ¸ÙŠÙØ© Ø¹Ø§Ù…Ø© Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙ„Ø§ØªØ± Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ù…Ø³ÙˆÙ‚ Ø¹Ù„Ù‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù†Ø´Ø·.
 */
function filterCards() {
    currentSearchTerm = document.getElementById('searchInput').value;
    // currentMarketerFilter ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© handleMarketerFilterChange

    if (currentActiveTabId === 'tab1') {
        renderStudentsCards(allStudentsData);
    } else if (currentActiveTabId === 'tab2') {
        renderPayersCards(allPayersData);
    } else if (currentActiveTabId === 'tab3') {
        renderMarketersCards(allMarketersData);
    } else if (currentActiveTabId === 'tab4') {
        renderCommissionsCards(allCommissionsData);
    }
}

/**
 * ÙˆØ¸ÙŠÙØ© Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØºÙŠÙŠØ± Ù‚ÙŠÙ…Ø© ÙÙ„ØªØ± Ø§Ù„Ù…Ø³ÙˆÙ‚ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙ„ØªØ±Ø©.
 */
function handleMarketerFilterChange(selectedMarketerId) {
    currentMarketerFilter = selectedMarketerId;
    filterCards(); 
}

async function showTab(tabIndex) {
  const tabs = document.querySelectorAll('.tab');
  const contents = document.querySelectorAll('.tab-content');

  tabs.forEach(tab => tab.classList.remove('active'));
  contents.forEach(content => content.classList.remove('active'));

  const activeContent = contents[tabIndex - 1];
  tabs[tabIndex - 1].classList.add('active');
  activeContent.classList.add('active');
  
  currentActiveTabId = activeContent.id;
  
  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù†Ø´Ø· Ø¥Ù† Ù„Ù… ØªÙƒÙ† Ù…Ø­Ù…Ù„Ø©
  if (currentActiveTabId === 'tab1' && allStudentsData.length === 0) {
      await loadStudentsData();
  } else if (currentActiveTabId === 'tab2' && allPayersData.length === 0) {
      await loadPayersData();
  } else if (currentActiveTabId === 'tab3' && allMarketersData.length === 0) {
      await loadMarketersData();
  } else if (currentActiveTabId === 'tab4' && allCommissionsData.length === 0) {
      await loadCommissionsData();
  }
  
  // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±Ø© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  filterCards();
}

// ==============================================
//        ÙˆØ¸Ø§Ø¦Ù Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ÙˆÙ‘Ù‚ÙŠÙ† Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹
// ==============================================

async function populateMarketerSelect() {
    const selectElement = document.getElementById(SELECT_ELEMENT_ID);
    if (!selectElement) return;

    // ØªØ¹Ø·ÙŠÙ„ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
    selectElement.disabled = true;
    selectElement.innerHTML = `<option value="">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ÙˆÙ‚ÙŠÙ†...</option>`;

    try {
        // Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ÙˆÙ‚ÙŠÙ† Ù…Ø³Ø¨Ù‚Ø§Ù‹ØŒ Ù‚Ù… Ø¨ØªØ­Ù…ÙŠÙ„Ù‡Ø§
        if (allMarketersData.length === 0) {
             const response = await fetch(MARKETERS_DATA_URL);
             allMarketersData = await response.json();
        }
        
        selectElement.innerHTML = `<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ÙˆÙ‘Ù‚ÙŠÙ†</option>`; // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ

        if (Array.isArray(allMarketersData)) {
            allMarketersData.forEach(marketer => {
                const id = marketer['marketer_id'];
                const name = marketer['fullname'];
                if (id && name && id.trim() !== '') {
                    const option = document.createElement('option');
                    // Ø§Ù„Ù‚ÙŠÙ…Ø© Ù‡ÙŠ Ø§Ù„Ù…Ø¹Ø±Ù (ID) Ù„Ù„ØªØµÙÙŠØ©
                    option.value = id.toLowerCase(); 
                    option.textContent = `${name} (${id})`;
                    selectElement.appendChild(option);
                }
            });
        }
    } catch (error) {
        console.error("Failed to load marketers for select filter:", error);
        selectElement.innerHTML = `<option value="">ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Ø­Ø§ÙˆÙ„ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©)</option>`;
    } finally {
        selectElement.disabled = false;
    }
}


// ---------------- ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ----------------
document.addEventListener('DOMContentLoaded', async () => {
    // Ø¥Ø®ÙØ§Ø¡ Loader Ø§Ù„Ø´Ø§Ù…Ù„
    const loader = document.getElementById('loader');
    loader.style.opacity = '0';
    setTimeout(() => {
        loader.style.display = 'none';
    }, 300);

    // 1. Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ÙˆÙ‚ÙŠÙ† Ø£ÙˆÙ„Ø§Ù‹
    await populateMarketerSelect();

    // 2. ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø£ÙˆÙ„ ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    showTab(1);
});
</script>

</body>
</html>


